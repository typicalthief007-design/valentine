<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Valentine Surprise</title>

  <style>
    :root{
      --bg1:#ffd3dc;
      --bg2:#f2a7b8;
      --bg3:#d989a2;

      --card: rgba(255,255,255,0.90);
      --accent:#ff3b7a;
      --text:#141414;

      --spark: #ff2f77; /* particle base */
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
      color:var(--text);
      background: radial-gradient(circle at 30% 20%, var(--bg1), var(--bg2), var(--bg3));
    }

    /* Animated background glow */
    .bgGlow{
      position:fixed;
      inset:-40%;
      z-index:0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,0.55), transparent 45%),
        radial-gradient(circle at 80% 30%, rgba(255, 60, 120, 0.25), transparent 50%),
        radial-gradient(circle at 60% 80%, rgba(255, 220, 240, 0.28), transparent 55%),
        radial-gradient(circle at 30% 75%, rgba(255, 110, 180, 0.22), transparent 50%);
      filter: blur(30px);
      animation: drift 14s ease-in-out infinite alternate;
      transform: translate3d(0,0,0);
      pointer-events:none;
    }
    @keyframes drift{
      from{ transform: translate3d(-3%, -2%, 0) scale(1.02); }
      to  { transform: translate3d(3%, 2%, 0) scale(1.07); }
    }

    /* Canvas particles */
    #fx{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
      display: block;
    }

    /* Empty screen during heart formation */
    body.heartMode #fx{ z-index: 6; }
    body.heartMode .page{ display:none !important; }
    body.heartMode .balloon-layer{ display:none !important; }

    /* Cards */
    .page{
      width: min(640px, 92vw);
      padding: 38px 30px 42px;
      border-radius: 24px;
      background: rgba(255,255,255,0.88);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 70px rgba(0,0,0,0.22);
      text-align:center;
      position:relative;
      z-index: 3;
      border: 1px solid rgba(255,255,255,0.45);
    }
    .hidden{ display:none; }

    h1{
      margin: 0 0 12px;
      font-size: clamp(28px, 4vw, 42px);
      letter-spacing: -0.6px;
    }
    p{
      margin: 8px 0 24px;
      color: rgba(0,0,0,0.68);
      line-height:1.5;
      font-size: 16px;
    }

    /* Buttons */
    .btn-row{
      display:flex;
      justify-content:center;
      gap:14px;
      margin-top: 12px;
      flex-wrap:wrap;
      position:relative;
      min-height: 58px;
    }
    button{
      border:none;
      padding:14px 26px;
      font-size:16px;
      font-weight:800;
      border-radius:999px;
      cursor:pointer;
      box-shadow: 0 12px 26px rgba(0,0,0,0.18);
      min-width: 160px;
      transition: transform 0.12s ease;
      user-select:none;
    }
    button:hover{ transform: translateY(-2px) scale(1.02); }

    .primary{
      background: var(--accent);
      color:#fff;
    }
    .dark{
      background:#111;
      color:#fff;
    }

    /* NO button runs away */
    #noBtn{
      position:absolute;
      left: 50%;
      top: 0;
      transform: translateX(160px);
    }

    /* Heart balloons layer */
    .balloon-layer{
      position: fixed;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
    }

    .balloonWrap{
      position:absolute;
      width: 58px;
      height: 74px;
      animation: floatUp linear infinite;
      will-change: transform;
      transform: translate3d(var(--pushX, 0px), var(--pushY, 0px), 0);
      opacity: 0.92;
      filter: drop-shadow(0 12px 16px rgba(0,0,0,0.18));
    }

    /* heart balloon shape */
    .heartBalloon{
      position: relative;
      width: 100%;
      height: 100%;
      transform: rotate(45deg);
      border-radius: 10px;
      background: #ff3b7a;
      overflow: hidden;
    }
    .heartBalloon::before,
    .heartBalloon::after{
      content:"";
      position:absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
    }
    .heartBalloon::before{ top: -50%; left: 0; }
    .heartBalloon::after { left: -50%; top: 0; }

    .shine{
      position:absolute;
      top: 16px;
      left: 18px;
      width: 14px;
      height: 18px;
      border-radius: 999px;
      background: rgba(255,255,255,0.42);
      transform: rotate(-18deg);
      z-index: 2;
    }
    .string{
      position:absolute;
      left: 50%;
      bottom: -42px;
      width: 2px;
      height: 56px;
      background: rgba(0,0,0,0.18);
      transform: translateX(-50%);
      border-radius: 2px;
    }

    @keyframes floatUp{
      from{ top: 110vh; }
      to  { top: -160px; }
    }

    /* Page 3: Envelope */
    .page2Wrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 18px;
    }

    .hint{
      font-size: 14px;
      opacity: 0.72;
      margin-top: -6px;
    }

    .envelopeStage{
      position: relative;
      width: min(440px, 86vw);
      height: 280px;
      margin-top: 8px;
    }

    .envelope{
      position:absolute;
      inset: 40px 0 0 0;
      margin:auto;
      width: 100%;
      height: 220px;
      cursor: pointer;
      transform: translateZ(0);
    }

    .envBody{
      position:absolute;
      inset: 0;
      background: rgba(255,255,255,0.90);
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.55);
      overflow:hidden;
    }

    .envBottom{
      position:absolute;
      left: 0; right: 0; bottom: 0;
      height: 64%;
      background: linear-gradient(to bottom, rgba(255,60,120,0.08), rgba(255,60,120,0.16));
      clip-path: polygon(0 25%, 50% 75%, 100% 25%, 100% 100%, 0 100%);
      opacity: 0.8;
    }

    .envTop{
      position:absolute;
      left:0; right:0; top:0;
      height: 70%;
      background: rgba(255,255,255,0.92);
      clip-path: polygon(0 0, 50% 70%, 100% 0, 100% 45%, 50% 100%, 0 45%);
      transform-origin: top center;
      transition: transform 700ms cubic-bezier(.2,.9,.2,1), filter 700ms;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,0.10));
    }

    .seal{
      position:absolute;
      left:50%;
      top: 54%;
      transform: translate(-50%,-50%);
      width: 62px;
      height: 62px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.65), rgba(255,59,122,1));
      box-shadow: 0 12px 24px rgba(0,0,0,0.18);
      display:grid;
      place-items:center;
      font-size: 22px;
      color: white;
      z-index: 5;
      transition: transform 600ms ease, opacity 300ms ease;
    }

    .noteCard{
      position:absolute;
      left: 50%;
      width: min(380px, 80vw);
      transform: translateX(-50%);
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(255,255,255,0.55);
      border-radius: 18px;
      box-shadow: 0 18px 50px rgba(0,0,0,0.18);
      padding: 18px 18px;
      text-align:left;
      opacity: 0;
      pointer-events: none;
    }

    .noteCard h3{
      margin: 0 0 8px;
      font-size: 18px;
    }
    .noteCard p{
      margin: 0;
      color: rgba(0,0,0,0.72);
      font-size: 15px;
      line-height: 1.55;
    }

    #note1{ top: 122px; }
    #note2{ top: 145px; }

    .opened .envTop{ transform: rotateX(165deg); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.05)); }
    .opened .seal{ transform: translate(-50%,-50%) scale(0.92); opacity: 0.92; }

    .opened #note1{
      animation: pop1 900ms cubic-bezier(.2,.9,.2,1) forwards;
      pointer-events: auto;
    }
    .opened #note2{
      animation: pop2 1100ms cubic-bezier(.2,.9,.2,1) forwards;
      pointer-events: auto;
    }

    @keyframes pop1{
      0%   { opacity:0; transform: translateX(-50%) translateY(0) scale(0.98); }
      55%  { opacity:1; transform: translateX(-50%) translateY(-92px) scale(1.02); }
      100% { opacity:1; transform: translateX(-50%) translateY(-78px) scale(1.00); }
    }
    @keyframes pop2{
      0%   { opacity:0; transform: translateX(-50%) translateY(0) scale(0.98); }
      60%  { opacity:1; transform: translateX(-50%) translateY(-24px) scale(1.02); }
      100% { opacity:1; transform: translateX(-50%) translateY(-14px) scale(1.00); }
    }

    /* small helper text */
    .subtle{
      font-size: 14px;
      opacity: 0.72;
      margin-top: -6px;
    }
  </style>
</head>

<body>
  <div class="bgGlow" aria-hidden="true"></div>
  <div class="balloon-layer" id="balloonLayer" aria-hidden="true"></div>
  <canvas id="fx"></canvas>

  <!-- Music -->
  <audio id="bgMusic" loop preload="auto">
    <source src="love.mp3" type="audio/mpeg" />
  </audio>

  <!-- Page 0: Start -->
  <div class="page" id="page0">
    <h1>Hi Piggy</h1>
    <p>Press start when you’re ready.</p>
    <div class="btn-row" style="min-height:auto;">
      <button class="primary" id="startBtn">Start</button>
    </div>
    <div class="subtle">This will start the music.</div>
  </div>

  <!-- Page 1: Valentine question -->
  <div class="page hidden" id="page1">
    <h1>Will you be my Valentine, Piggy?</h1>
    <p>Be honest… you can’t say no anyway.</p>

    <div class="btn-row">
      <button class="primary" id="yesBtn">YES</button>
      <button class="dark" id="noBtn">NO</button>
    </div>
  </div>

  <!-- Page 2: Envelope -->
  <div class="page hidden" id="page2">
    <div class="page2Wrap">
      <h1 style="margin-bottom:6px;">For you, Piggy</h1>
      <div class="hint">Tap the envelope</div>

      <div class="envelopeStage">
        <div class="envelope" id="envelope">
          <div class="envBody">
            <div class="envBottom"></div>
          </div>

          <div class="envTop"></div>
          <div class="seal">❤</div>

          <div class="noteCard" id="note1">
            <h3>Now it’s official.</h3>
            <p>You’re my Valentine.</p>
          </div>

          <div class="noteCard" id="note2">
            <h3>My favourite things about you</h3>
            <p>
              I love your smile, your eyes, your love for me, your care, your respect,
              the way u hold my hand, your hugs, your jokes, your kisses and Just you.
              <br><br>
              Piggy, you make my days lighter and my heart calmer. Thank you for being you.
              I’m grateful for you — always.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ==========================
       Helpers
    ========================== */
    function rand(min,max){ return Math.random()*(max-min)+min; }

    /* ==========================
       Music: starts on Start button (reliable)
    ========================== */
    const bgMusic = document.getElementById("bgMusic");
    let musicStarted = false;

    function startMusic(){
      if(musicStarted) return;
      musicStarted = true;

      bgMusic.volume = 0;
      bgMusic.play().catch(()=>{});

      // fade in to a soft volume
      let v = 0;
      const target = 0.35;
      const fade = setInterval(() => {
        v += 0.02;
        bgMusic.volume = Math.min(v, target);
        if(v >= target) clearInterval(fade);
      }, 120);
    }

    /* ==========================
       Page switching
    ========================== */
    const page0 = document.getElementById("page0");
    const page1 = document.getElementById("page1");
    const page2 = document.getElementById("page2");

    function showPage(el){
      page0.classList.add("hidden");
      page1.classList.add("hidden");
      page2.classList.add("hidden");
      el.classList.remove("hidden");
    }

    document.getElementById("startBtn").addEventListener("click", () => {
      startMusic();
      showPage(page1);
    });

    /* ==========================
       Heart balloons (only on page1)
    ========================== */
    const balloonLayer = document.getElementById("balloonLayer");
    const balloons = [];
    const BALLOON_COUNT = 16;

    const balloonColors = [
      "rgba(255, 59, 122, 0.92)",
      "rgba(255, 206, 86, 0.92)",
      "rgba(54, 162, 235, 0.92)",
      "rgba(153, 102, 255, 0.92)",
      "rgba(255, 159, 64, 0.92)"
    ];

    function createHeartBalloon(i){
      const wrap = document.createElement("div");
      wrap.className = "balloonWrap";

      const heart = document.createElement("div");
      heart.className = "heartBalloon";
      heart.style.background = balloonColors[i % balloonColors.length];

      const shine = document.createElement("div");
      shine.className = "shine";

      const string = document.createElement("div");
      string.className = "string";

      heart.appendChild(shine);
      wrap.appendChild(heart);
      wrap.appendChild(string);

      const x = rand(5, 95);
      const dur = rand(9, 16);
      const delay = rand(-16, 0);
      const size = rand(46, 66);

      wrap.style.left = `${x}vw`;
      wrap.style.width = `${size}px`;
      wrap.style.height = `${size*1.25}px`;
      wrap.style.animationDuration = `${dur}s`;
      wrap.style.animationDelay = `${delay}s`;

      balloonLayer.appendChild(wrap);

      balloons.push({
        el: wrap,
        pushX: 0, pushY: 0,
        targetX: 0, targetY: 0,
        strength: rand(0.85, 1.15)
      });
    }

    for(let i=0;i<BALLOON_COUNT;i++) createHeartBalloon(i);

    let mouseX = -9999, mouseY = -9999;
    document.addEventListener("mousemove", (e)=>{ mouseX=e.clientX; mouseY=e.clientY; });

    function updateBalloons(){
      const page1Visible = !page1.classList.contains("hidden");
      balloonLayer.style.display = page1Visible ? "block" : "none";

      if(page1Visible){
        for(const b of balloons){
          const r = b.el.getBoundingClientRect();
          const cx = r.left + r.width/2;
          const cy = r.top + r.height/2;

          const dx = cx - mouseX;
          const dy = cy - mouseY;
          const dist = Math.hypot(dx, dy);

          const range = 140;
          if(dist < range){
            const push = (1 - dist/range) * 16 * b.strength; // subtle movement
            const nx = dx / (dist || 1);
            const ny = dy / (dist || 1);
            b.targetX = nx * push;
            b.targetY = ny * push;
          } else {
            b.targetX = 0;
            b.targetY = 0;
          }

          b.pushX += (b.targetX - b.pushX) * 0.08;
          b.pushY += (b.targetY - b.pushY) * 0.08;

          b.el.style.setProperty("--pushX", `${b.pushX}px`);
          b.el.style.setProperty("--pushY", `${b.pushY}px`);
        }
      }
      requestAnimationFrame(updateBalloons);
    }
    updateBalloons();

    /* ==========================
       NO button runs away (page1 only)
    ========================== */
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");

    function moveNo(){
      const rect = page1.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();
      const pad = 14;

      const minX = pad;
      const maxX = rect.width - btn.width - pad;
      const minY = 120;
      const maxY = rect.height - btn.height - pad;

      const x = rand(minX, Math.max(minX, maxX));
      const y = rand(minY, Math.max(minY, maxY));

      noBtn.style.left = `${x}px`;
      noBtn.style.top = `${y}px`;
      noBtn.style.transform = "translateX(0)";
    }

    function nearCursorToNo(x,y){
      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      return Math.hypot(cx-x, cy-y) < 90;
    }

    document.addEventListener("mousemove", (e)=>{
      if(page1.classList.contains("hidden")) return;
      if(nearCursorToNo(e.clientX, e.clientY)) moveNo();
    });

    noBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      moveNo();
    });

    /* ==========================
       Particles (ONE COLOUR) + filled heart formation
       - ambient everywhere on all pages
       - on YES: hide pages and gather into dense filled heart
       - then go to page2 and scatter back to ambient
    ========================== */
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d");

    let W = 0, H = 0, DPR = 1;
    function resizeCanvas(){
      DPR = window.devicePixelRatio || 1;
      W = Math.floor(window.innerWidth);
      H = Math.floor(window.innerHeight);
      canvas.width = Math.floor(W * DPR);
      canvas.height = Math.floor(H * DPR);
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    function drawSpark(x,y,r,alpha){
      ctx.beginPath();
      ctx.arc(x,y,r*3.6,0,Math.PI*2);
      ctx.fillStyle = `rgba(255, 47, 119, ${alpha*0.16})`;
      ctx.fill();

      ctx.beginPath();
      ctx.arc(x,y,r*2.2,0,Math.PI*2);
      ctx.fillStyle = `rgba(255, 47, 119, ${alpha*0.28})`;
      ctx.fill();

      ctx.beginPath();
      ctx.arc(x,y,r,0,Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255, ${Math.min(1, alpha*1.1)})`;
      ctx.fill();
    }

    function drawCanvasContrast(){
      const g = ctx.createRadialGradient(W/2, H/2, Math.min(W,H)*0.10, W/2, H/2, Math.min(W,H)*0.85);
      g.addColorStop(0, "rgba(0,0,0,0.06)");
      g.addColorStop(1, "rgba(0,0,0,0.22)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,W,H);
    }

    function heartPoint(t){
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
      return { x, y };
    }

    function buildFilledHeartTargets(count, cx, cy, scale){
      const targets = [];
      for(let i=0;i<count;i++){
        const t = Math.random() * Math.PI * 2;
        const p = heartPoint(t);

        // Strong centre density
        const k = Math.pow(Math.random(), 2.8);
        const factor = 0.08 + 0.92 * k;

        targets.push({
          x: cx + p.x * scale * factor,
          y: cy - p.y * scale * factor
        });
      }
      return targets;
    }

    const PARTICLE_COUNT = 1700; // dense filled heart
    let particles = [];
    let mode = "ambient"; // ambient | gather | hold | scatter
    let modeStart = performance.now();
    let targets = [];

    function initParticlesEverywhere(){
      particles = Array.from({length: PARTICLE_COUNT}, () => ({
        x: Math.random()*W,
        y: Math.random()*H,
        vx: (Math.random()-0.5)*0.20,
        vy: (Math.random()-0.5)*0.20,
        tx: 0, ty: 0,
        r: rand(0.9, 2.2),
        a: rand(0.70, 1.0)
      }));
    }
    initParticlesEverywhere();

    function setMode(m){
      mode = m;
      modeStart = performance.now();
    }

    function startGather(){
      document.body.classList.add("heartMode");
      setMode("gather");

      const cx = W/2;
      const cy = H/2;
      const scale = Math.min(W, H) * 0.030;

      targets = buildFilledHeartTargets(PARTICLE_COUNT, cx, cy, scale);

      for(let i=0;i<particles.length;i++){
        particles[i].tx = targets[i].x;
        particles[i].ty = targets[i].y;
        particles[i].a = 1.0;
      }
    }

    function toPage2Scatter(){
      showPage(page2);
      document.body.classList.remove("heartMode");

      const cx = W/2, cy = H/2;
      for(const p of particles){
        const dx = p.x - cx;
        const dy = p.y - cy;
        const d = Math.hypot(dx, dy) || 1;
        const nx = dx/d, ny = dy/d;
        const speed = rand(1.4, 5.2);

        p.vx = nx*speed + (Math.random()-0.5)*0.8;
        p.vy = ny*speed + (Math.random()-0.5)*0.8;
        p.a = rand(0.70, 1.0);
      }
      setMode("scatter");
    }

    function animate(now){
      ctx.clearRect(0,0,W,H);
      drawCanvasContrast();

      const elapsed = now - modeStart;

      if(mode === "ambient"){
        for(const p of particles){
          p.x += p.vx;
          p.y += p.vy;

          p.vx += (Math.random()-0.5)*0.014;
          p.vy += (Math.random()-0.5)*0.014;

          p.vx = Math.max(-0.38, Math.min(0.38, p.vx));
          p.vy = Math.max(-0.38, Math.min(0.38, p.vy));

          if(p.x < -10) p.x = W+10;
          if(p.x > W+10) p.x = -10;
          if(p.y < -10) p.y = H+10;
          if(p.y > H+10) p.y = -10;

          drawSpark(p.x,p.y,p.r,p.a);
        }
      }

      if(mode === "gather"){
        const pull = elapsed < 1000 ? 0.080 : 0.060;

        for(const p of particles){
          p.x += (p.tx - p.x) * pull;
          p.y += (p.ty - p.y) * pull;
          p.vx *= 0.86;
          p.vy *= 0.86;
          drawSpark(p.x,p.y,p.r,1.0);
        }

        if(elapsed > 2400) setMode("hold");
      }

      if(mode === "hold"){
        for(const p of particles){
          drawSpark(p.x,p.y,p.r,1.0);
        }
        if(elapsed > 750) toPage2Scatter();
      }

      if(mode === "scatter"){
        for(const p of particles){
          p.x += p.vx;
          p.y += p.vy;

          p.vx *= 0.965;
          p.vy *= 0.965;

          if(elapsed > 950){
            p.vx += ((Math.random()-0.5)*0.20 - p.vx) * 0.03;
            p.vy += ((Math.random()-0.5)*0.20 - p.vy) * 0.03;
          }

          if(p.x < -10) p.x = W+10;
          if(p.x > W+10) p.x = -10;
          if(p.y < -10) p.y = H+10;
          if(p.y > H+10) p.y = -10;

          drawSpark(p.x,p.y,p.r,p.a);
        }

        if(elapsed > 1600) setMode("ambient");
      }

      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

    /* YES click */
    yesBtn.addEventListener("click", () => {
      // ensure music is running (in case)
      startMusic();
      startGather();
    });

    /* Envelope interaction */
    const envelope = document.getElementById("envelope");
    envelope.addEventListener("click", () => {
      envelope.classList.toggle("opened");
    });
  </script>
</body>
</html>
